<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم جامع مدیریت فرآیند EnglishLand</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .tree { white-space: nowrap; overflow-x: auto; min-width: 800px; padding-bottom: 50px; display: flex; justify-content: center; }
        .tree ul { padding-top: 20px; position: relative; display: flex; justify-content: center; }
        .tree li { float: left; text-align: center; list-style-type: none; position: relative; padding: 20px 5px 0 5px; }
        .tree li::before, .tree li::after { content: ''; position: absolute; top: 0; right: 50%; border-top: 2px solid #cbd5e1; width: 50%; height: 20px; }
        .tree li::after { right: auto; left: 50%; border-left: 2px solid #cbd5e1; }
        .tree li:only-child::after, .tree li:only-child::before { display: none; }
        .tree li:only-child { padding-top: 0; }
        .tree li:first-child::before, .tree li:last-child::after { border: 0 none; }
        .tree li:last-child::before { border-right: 2px solid #cbd5e1; border-radius: 0 5px 0 0; }
        .tree li:first-child::after { border-radius: 5px 0 0 0; }
        .tree ul ul::before { content: ''; position: absolute; top: 0; left: 50%; border-left: 2px solid #cbd5e1; width: 0; height: 20px; }
        .tree-card { background: white; border: 1px solid #e2e8f0; padding: 10px; border-radius: 12px; display: inline-block; min-width: 140px; text-decoration: none; color: #334155; font-size: 0.8rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.2s; position: relative; z-index: 10; }
        .tree-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: #6366f1; z-index: 20; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // 1. ROLES DATABASE
        const rolesDB = [
            { id: 'R-CEO', title: 'مدیر عامل (CEO)', parent: null, holder: 'P-01', color: 'bg-amber-50 border-amber-300 text-amber-900' },
            { id: 'R-INT', title: 'مدیر داخلی & HR', parent: 'R-CEO', holder: 'P-02', color: 'bg-indigo-50 border-indigo-300 text-indigo-900' },
            { id: 'R-FIN', title: 'مدیر مالی', parent: 'R-CEO', holder: 'P-03', color: 'bg-emerald-50 border-emerald-300 text-emerald-900' },
            { id: 'R-MKT', title: 'مدیر مارکتینگ', parent: 'R-CEO', holder: 'P-04', color: 'bg-pink-50 border-pink-300 text-pink-900' },
            { id: 'R-EDU', title: 'سوپروایزر آموزشی', parent: 'R-CEO', holder: 'P-05', color: 'bg-red-50 border-red-300 text-red-900' },
            
            { id: 'R-SUP-H', title: 'کارشناس آموزشی (H)', parent: 'R-EDU', holder: 'P-06', color: 'bg-white border-slate-200' },
            { id: 'R-SUP-O', title: 'کارشناس آموزشی (O)', parent: 'R-EDU', holder: 'P-07', color: 'bg-white border-slate-200' },
            { id: 'R-REC-S', title: 'سرپرست پذیرش', parent: 'R-INT', holder: 'P-08', color: 'bg-white border-slate-200' },
            { id: 'R-ADM', title: 'مسئول اداری', parent: 'R-INT', holder: 'P-09', color: 'bg-white border-slate-200' },
            { id: 'R-SAL', title: 'کارشناس فروش', parent: 'R-MKT', holder: 'P-10', color: 'bg-white border-slate-200' },
            { id: 'R-EVT', title: 'مدیر رویداد', parent: 'R-MKT', holder: 'P-11', color: 'bg-white border-slate-200' },

            // Leaf nodes for chart completeness
            { id: 'R-TCH-H', title: 'مدرسین حضوری', parent: 'R-SUP-H', holder: 'P-TCH', color: 'bg-slate-50 border-dashed border-slate-300 text-slate-500' },
            { id: 'R-TCH-O', title: 'مدرسین آنلاین', parent: 'R-SUP-O', holder: 'P-TCH', color: 'bg-slate-50 border-dashed border-slate-300 text-slate-500' },
            { id: 'R-SRV', title: 'نیروی خدمات', parent: 'R-ADM', holder: 'P-SRV', color: 'bg-slate-50 border-dashed border-slate-300 text-slate-500' },
        ];

        // 2. PERSONNEL DATABASE
        const personnelDB = [
            { code: 'P-01', name: 'دکتر بهاره', lineManager: null },
            { code: 'P-02', name: 'میس غزال', lineManager: 'P-01' },
            { code: 'P-03', name: 'آقای ایمان', lineManager: 'P-01' },
            { code: 'P-04', name: 'آقای اشکان', lineManager: 'P-01' },
            { code: 'P-05', name: 'میس افسانه', lineManager: 'P-01' },
            { code: 'P-06', name: 'میس الهه', lineManager: 'P-05' },
            { code: 'P-07', name: 'میس مرجان', lineManager: 'P-05' },
            { code: 'P-08', name: 'میس رها', lineManager: 'P-02' },
            { code: 'P-09', name: 'میس زهرا', lineManager: 'P-02' },
            { code: 'P-10', name: 'میس شیرین', lineManager: 'P-04' },
            { code: 'P-11', name: 'میس پرنیان', lineManager: 'P-04' },
            { code: 'P-TCH', name: 'تیم اساتید', lineManager: null },
            { code: 'P-SRV', name: 'پرسنل خدمات', lineManager: null },
        ];

        // 3. PROCESS DEFINITIONS (35 Processes)
        const processesDB = [
            { id: 'BP-01', name: 'جذب و ثبت‌نام', owner: 'R-MKT', description: 'مسیر تبدیل تماس تلفنی به دانش‌آموز.' },
            { id: 'BP-02', name: 'برگزاری رویداد', owner: 'R-EVT', description: 'طراحی و اجرای ایونت‌های مناسبتی.' },
            { id: 'BP-03', name: 'تضمین کیفیت آموزش', owner: 'R-EDU', description: 'آبزرو کلاس‌ها و فیدبک به معلم.' },
            { id: 'BP-04', name: 'مدیریت تنخواه و خرید', owner: 'R-FIN', description: 'مدیریت هزینه‌های جاری.' },
            { id: 'BP-05', name: 'مدیریت شکایات (CRM)', owner: 'R-INT', description: 'رسیدگی به اعتراضات والدین.' },
            { id: 'BP-06', name: 'تدارکات و نظافت', owner: 'R-INT', description: 'نظافت محیط و تامین ملزومات.' },
            { id: 'BP-07', name: 'حقوق و دستمزد', owner: 'R-FIN', description: 'محاسبه ساعات کار و پرداخت حقوق.' },
            { id: 'BP-08', name: 'برنامه‌ریزی کلاس', owner: 'R-EDU', description: 'نیازسنجی و زمان‌بندی ترم جدید.' },
            { id: 'BP-09', name: 'ادغام کلاس‌ها', owner: 'R-EDU', description: 'مدیریت کلاس‌های زیر حد نصاب.' },
            { id: 'BP-10', name: 'تبلیغات و کمپین', owner: 'R-MKT', description: 'طراحی و انتشار تبلیغات.' },
            { id: 'BP-11', name: 'سوشال مدیا', owner: 'R-MKT', description: 'تقویم محتوایی و انتشار پست/استوری.' },
            { id: 'BP-12', name: 'درخواست مرخصی', owner: 'R-INT', description: 'ثبت و تایید مرخصی و جایگزینی.' },
            { id: 'BP-13', name: 'درخواست مساعده', owner: 'R-FIN', description: 'درخواست وام یا پیش‌پرداخت.' },
            { id: 'BP-14', name: 'استخدام اداری', owner: 'R-INT', description: 'جذب نیروهای ستادی.' },
            { id: 'BP-15', name: 'استخدام معلم', owner: 'R-EDU', description: 'فراخوان و دمو معلمین.' },
            { id: 'BP-16', name: 'فرآیند انضباطی', owner: 'R-INT', description: 'رسیدگی به تخلفات و اعمال قانون.' },
            { id: 'BP-17', name: 'مدیریت بحران', owner: 'R-CEO', description: 'مدیریت شرایط اضطراری سازمانی.' },
            { id: 'BP-18', name: 'حوادث آنی', owner: 'R-INT', description: 'واکنش سریع به حوادث فیزیکی.' },
            { id: 'BP-19', name: 'سیاست‌گذاری کلان', owner: 'R-CEO', description: 'تعیین اهداف سالانه.' },
            { id: 'BP-20', name: 'تولید کلیپ آموزشی', owner: 'R-EDU', description: 'سناریو، ضبط، تدوین و انتشار کلیپ.' },
            { id: 'BP-21', name: 'بایگانی اسناد', owner: 'R-INT', description: 'بایگانی فیزیکی و دیجیتال پرونده‌ها.' },
            { id: 'BP-22', name: 'زیرساخت و سیستم', owner: 'R-INT', description: 'آپدیت LIMS، سخت‌افزار و شبکه.' },
            { id: 'BP-23', name: 'مدیریت گروه‌های خانواده', owner: 'R-INT', description: 'ساخت گروه، تولید و ارسال محتوا.' },
            { id: 'BP-24', name: 'صدور کارنامه', owner: 'R-EDU', description: 'نمره‌دهی، چاپ، طراحی و تحویل.' },
            { id: 'BP-25', name: 'پشتیبانی آنلاین', owner: 'R-EDU', description: 'رفع مشکلات فنی پلتفرم و کلاس مجازی.' },
            { id: 'BP-26', name: 'پشتیبانی آفلاین', owner: 'R-REC-S', description: 'پیگیری تلفنی غیبت و تکالیف.' },
            { id: 'BP-27', name: 'پشتیبانی معلمین', owner: 'R-INT', description: 'تکثیر ورک‌شیت، ماژیک و امکانات کلاس.' },
            { id: 'BP-28', name: 'تحقیق و توسعه (R&D)', owner: 'R-CEO', description: 'طراحی محصولات جدید.' },
            { id: 'BP-29', name: 'خروج و تسویه (Offboarding)', owner: 'R-INT', description: 'تحویل اموال و لغو دسترسی‌ها.' },
            { id: 'BP-30', name: 'فروش سازمانی (B2B)', owner: 'R-CEO', description: 'قرارداد با مدارس و سازمان‌ها.' },
            { id: 'BP-31', name: 'سنجش رضایت (NPS)', owner: 'R-MKT', description: 'نظرسنجی دوره‌ای و تحلیل.' },
            { id: 'BP-32', name: 'انبارگردانی و اموال', owner: 'R-FIN', description: 'کنترل دارایی‌های فیزیکی.' },
            { id: 'BP-33', name: 'مدیریت دانش', owner: 'R-INT', description: 'مستندسازی رویه‌ها و آموزش‌ها.' },
            { id: 'BP-34', name: 'آزمون‌های ماک', owner: 'R-EDU', description: 'برگزاری آزمون‌های شبیه‌سازی شده.' },
            { id: 'BP-35', name: 'باشگاه مشتریان (Alumni)', owner: 'R-MKT', description: 'مدیریت وفاداری و بازگشت مشتری.' },
        ];

        // 4. TASK MATRIX (FULL RECONSTRUCTION)
        const tasksDB = [
            // BP-01 Admission
            { id: 'T1-1', pid: 'BP-01', role: 'R-SAL', type: 'Main', desc: 'پاسخگویی تلفنی و ثبت لید در CRM', freq: 'روزانه' },
            { id: 'T1-2', pid: 'BP-01', role: 'R-SAL', type: 'Main', desc: 'مشاوره حضوری و متقاعدسازی والدین', freq: 'روزانه' },
            { id: 'T1-3', pid: 'BP-01', role: 'R-SUP-H', type: 'Support', desc: 'انجام آزمون تعیین سطح شفاهی/کتبی', freq: 'موردی' },
            { id: 'T1-4', pid: 'BP-01', role: 'R-ADM', type: 'Main', desc: 'دریافت مدارک و تکمیل فیزیکی پرونده', freq: 'روزانه' },
            { id: 'T1-5', pid: 'BP-01', role: 'R-REC-S', type: 'Control', desc: 'تایید نهایی پرونده و ثبت قطعی در سیستم', freq: 'روزانه' },

            // BP-02 Events
            { id: 'T2-1', pid: 'BP-02', role: 'R-EVT', type: 'Main', desc: 'ایده‌پردازی سناریو و تم رویداد', freq: 'فصلی' },
            { id: 'T2-2', pid: 'BP-02', role: 'R-FIN', type: 'Control', desc: 'برآورد و تایید بودجه رویداد', freq: 'موردی' },
            { id: 'T2-3', pid: 'BP-02', role: 'R-ADM', type: 'Support', desc: 'خرید لوازم دکور و پذیرایی', freq: 'موردی' },
            { id: 'T2-4', pid: 'BP-02', role: 'R-MKT', type: 'Main', desc: 'طراحی پوستر و تبلیغات رویداد', freq: 'موردی' },
            { id: 'T2-5', pid: 'BP-02', role: 'R-REC-S', type: 'Support', desc: 'مدیریت اجرایی و نظم‌دهی روز مراسم', freq: 'روز رویداد' },

            // BP-03 QA
            { id: 'T3-1', pid: 'BP-03', role: 'R-SUP-H', type: 'Main', desc: 'تدوین جدول زمان‌بندی مشاهده (Observation)', freq: 'ماهانه' },
            { id: 'T3-2', pid: 'BP-03', role: 'R-SUP-H', type: 'Main', desc: 'حضور در کلاس و تکمیل فرم ارزیابی', freq: 'هفتگی' },
            { id: 'T3-3', pid: 'BP-03', role: 'R-EDU', type: 'Control', desc: 'تحلیل گزارش‌های ارزیابی و امتیازدهی', freq: 'هفتگی' },
            { id: 'T3-4', pid: 'BP-03', role: 'R-SUP-H', type: 'Main', desc: 'جلسه بازخورد (Feedback) با مدرس', freq: 'هفتگی' },
            { id: 'T3-5', pid: 'BP-03', role: 'R-EDU', type: 'Main', desc: 'برنامه‌ریزی کارگاه‌های آموزشی (TTC)', freq: 'فصلی' },

            // BP-04 Petty Cash
            { id: 'T4-1', pid: 'BP-04', role: 'R-ADM', type: 'Main', desc: 'ثبت درخواست خرید کالا/خدمات', freq: 'روزانه' },
            { id: 'T4-2', pid: 'BP-04', role: 'R-INT', type: 'Control', desc: 'تایید ضرورت و انطباق با بودجه', freq: 'روزانه' },
            { id: 'T4-3', pid: 'BP-04', role: 'R-ADM', type: 'Main', desc: 'انجام خرید و دریافت فاکتور معتبر', freq: 'روزانه' },
            { id: 'T4-4', pid: 'BP-04', role: 'R-FIN', type: 'Control', desc: 'سندرسی فاکتورها و تسویه تنخواه', freq: 'هفتگی' },

            // BP-05 Complaints
            { id: 'T5-1', pid: 'BP-05', role: 'R-REC-S', type: 'Main', desc: 'ثبت اولیه شکایت و آرام‌سازی (سطح ۱)', freq: 'آنی' },
            { id: 'T5-2', pid: 'BP-05', role: 'R-INT', type: 'Control', desc: 'ارجاع به واحد تخصصی (مالی/آموزش)', freq: 'آنی' },
            { id: 'T5-3', pid: 'BP-05', role: 'R-EDU', type: 'Support', desc: 'کارشناسی فنی شکایات آموزشی', freq: 'موردی' },
            { id: 'T5-4', pid: 'BP-05', role: 'R-INT', type: 'Main', desc: 'تماس با شاکی و جلب رضایت نهایی', freq: 'موردی' },

            // BP-06 Logistics
            { id: 'T6-1', pid: 'BP-06', role: 'R-ADM', type: 'Main', desc: 'نظارت بر چک‌لیست نظافت روزانه', freq: 'روزانه' },
            { id: 'T6-2', pid: 'BP-06', role: 'R-ADM', type: 'Main', desc: 'کنترل موجودی انبار مصرفی', freq: 'هفتگی' },
            { id: 'T6-3', pid: 'BP-06', role: 'R-INT', type: 'Control', desc: 'بازرسی دوره‌ای سلامت تاسیسات', freq: 'ماهانه' },

            // BP-07 Payroll
            { id: 'T7-1', pid: 'BP-07', role: 'R-REC-S', type: 'Main', desc: 'استخراج کارکرد پرسنل اداری', freq: 'ماهانه' },
            { id: 'T7-2', pid: 'BP-07', role: 'R-EDU', type: 'Main', desc: 'تایید ساعات تدریس مدرسین', freq: 'ماهانه' },
            { id: 'T7-3', pid: 'BP-07', role: 'R-FIN', type: 'Main', desc: 'محاسبه حقوق، کسر بیمه و مالیات', freq: 'ماهانه' },
            { id: 'T7-4', pid: 'BP-07', role: 'R-CEO', type: 'Control', desc: 'تایید نهایی لیست پرداخت', freq: 'ماهانه' },
            { id: 'T7-5', pid: 'BP-07', role: 'R-FIN', type: 'Main', desc: 'واریز حقوق به حساب‌ها', freq: 'ماهانه' },

            // BP-08 Class Planning
            { id: 'T8-1', pid: 'BP-08', role: 'R-REC-S', type: 'Support', desc: 'ارائه آمار پیش‌ثبت‌نام و لیست انتظار', freq: 'فصلی' },
            { id: 'T8-2', pid: 'BP-08', role: 'R-SUP-H', type: 'Main', desc: 'دریافت برنامه زمانی مدرسین', freq: 'فصلی' },
            { id: 'T8-3', pid: 'BP-08', role: 'R-SUP-H', type: 'Main', desc: 'چیدمان اولیه جدول کلاس‌ها', freq: 'فصلی' },
            { id: 'T8-4', pid: 'BP-08', role: 'R-EDU', type: 'Control', desc: 'تصویب نهایی برنامه ترمیک', freq: 'فصلی' },
            { id: 'T8-5', pid: 'BP-08', role: 'R-ADM', type: 'Main', desc: 'تعریف کلاس‌ها در سیستم LIMS', freq: 'فصلی' },

            // BP-09 Class Merger
            { id: 'T9-1', pid: 'BP-09', role: 'R-ADM', type: 'Main', desc: 'گزارش کلاس‌های زیر حد نصاب', freq: 'شروع ترم' },
            { id: 'T9-2', pid: 'BP-09', role: 'R-EDU', type: 'Control', desc: 'تصمیم‌گیری برای ادغام یا انحلال', freq: 'شروع ترم' },
            { id: 'T9-3', pid: 'BP-09', role: 'R-SAL', type: 'Main', desc: 'مذاکره با والدین برای جابجایی', freq: 'شروع ترم' },
            { id: 'T9-4', pid: 'BP-09', role: 'R-FIN', type: 'Support', desc: 'محاسبه مابه‌التفاوت شهریه', freq: 'شروع ترم' },

            // BP-10 Advertising
            { id: 'T10-1', pid: 'BP-10', role: 'R-MKT', type: 'Main', desc: 'تدوین استراتژی و پیام کمپین', freq: 'فصلی' },
            { id: 'T10-2', pid: 'BP-10', role: 'R-FIN', type: 'Control', desc: 'تخصیص بودجه تبلیغات', freq: 'فصلی' },
            { id: 'T10-3', pid: 'BP-10', role: 'R-MKT', type: 'Main', desc: 'اجرای تبلیغات محیطی و دیجیتال', freq: 'فصلی' },
            { id: 'T10-4', pid: 'BP-10', role: 'R-SAL', type: 'Main', desc: 'ثبت دقیق ورودی‌ها (Leads)', freq: 'روزانه' },
            { id: 'T10-5', pid: 'BP-10', role: 'R-MKT', type: 'Control', desc: 'تحلیل نرخ تبدیل (Conversion Rate)', freq: 'پایان کمپین' },

            // BP-11 Social Media
            { id: 'T11-1', pid: 'BP-11', role: 'R-MKT', type: 'Main', desc: 'تدوین تقویم محتوایی ماهانه', freq: 'ماهانه' },
            { id: 'T11-2', pid: 'BP-11', role: 'R-EVT', type: 'Main', desc: 'تولید محتوا (عکس/فیلم) از کلاس‌ها', freq: 'هفتگی' },
            { id: 'T11-3', pid: 'BP-11', role: 'R-SAL', type: 'Main', desc: 'انتشار استوری و پست', freq: 'روزانه' },
            { id: 'T11-4', pid: 'BP-11', role: 'R-SAL', type: 'Main', desc: 'پاسخگویی دایرکت و کامنت', freq: 'روزانه' },

            // BP-12 Leave
            { id: 'T12-1', pid: 'BP-12', role: 'R-REC-S', type: 'Main', desc: 'ثبت درخواست مرخصی', freq: 'موردی' },
            { id: 'T12-2', pid: 'BP-12', role: 'R-INT', type: 'Control', desc: 'بررسی جانشین و تایید مرخصی', freq: 'موردی' },
            { id: 'T12-3', pid: 'BP-12', role: 'R-ADM', type: 'Support', desc: 'ثبت در سیستم حضور و غیاب', freq: 'موردی' },

            // BP-13 Advance Payment
            { id: 'T13-1', pid: 'BP-13', role: 'R-FIN', type: 'Main', desc: 'بررسی درخواست مساعده و سقف مجاز', freq: 'موردی' },
            { id: 'T13-2', pid: 'BP-13', role: 'R-CEO', type: 'Control', desc: 'تایید نهایی پرداخت', freq: 'موردی' },

            // BP-14 Admin Hiring
            { id: 'T14-1', pid: 'BP-14', role: 'R-INT', type: 'Main', desc: 'انتشار آگهی استخدام اداری', freq: 'موردی' },
            { id: 'T14-2', pid: 'BP-14', role: 'R-INT', type: 'Main', desc: 'مصاحبه عمومی و رفتاری', freq: 'موردی' },
            { id: 'T14-3', pid: 'BP-14', role: 'R-CEO', type: 'Control', desc: 'مصاحبه نهایی و گزینش', freq: 'موردی' },

            // BP-15 Teacher Hiring
            { id: 'T15-1', pid: 'BP-15', role: 'R-EDU', type: 'Main', desc: 'بررسی رزومه متقاضیان تدریس', freq: 'موردی' },
            { id: 'T15-2', pid: 'BP-15', role: 'R-SUP-H', type: 'Main', desc: 'برگزاری جلسه دمو (Demo)', freq: 'موردی' },
            { id: 'T15-3', pid: 'BP-15', role: 'R-EDU', type: 'Control', desc: 'تایید صلاحیت علمی و فنی', freq: 'موردی' },
            { id: 'T15-4', pid: 'BP-15', role: 'R-INT', type: 'Support', desc: 'عقد قرارداد همکاری', freq: 'موردی' },

            // BP-16 Disciplinary
            { id: 'T16-1', pid: 'BP-16', role: 'R-SUP-H', type: 'Main', desc: 'گزارش کتبی تخلف پرسنل/معلم', freq: 'موردی' },
            { id: 'T16-2', pid: 'BP-16', role: 'R-INT', type: 'Control', desc: 'بررسی مستندات و تذکر اولیه', freq: 'موردی' },
            { id: 'T16-3', pid: 'BP-16', role: 'R-CEO', type: 'Control', desc: 'صدور حکم کمیته انضباطی', freq: 'موردی' },
            { id: 'T16-4', pid: 'BP-16', role: 'R-ADM', type: 'Support', desc: 'درج در پرونده پرسنلی', freq: 'موردی' },

            // BP-17 Crisis
            { id: 'T17-1', pid: 'BP-17', role: 'R-INT', type: 'Main', desc: 'شناسایی و گزارش وضعیت بحرانی', freq: 'آنی' },
            { id: 'T17-2', pid: 'BP-17', role: 'R-CEO', type: 'Main', desc: 'تشکیل جلسه کمیته اضطرار', freq: 'آنی' },
            { id: 'T17-3', pid: 'BP-17', role: 'R-MKT', type: 'Support', desc: 'مدیریت شایعات و فضای رسانه‌ای', freq: 'آنی' },

            // BP-18 Incident
            { id: 'T18-1', pid: 'BP-18', role: 'R-REC-S', type: 'Main', desc: 'تخلیه اضطراری و تماس با امداد', freq: 'آنی' },
            { id: 'T18-2', pid: 'BP-18', role: 'R-INT', type: 'Control', desc: 'مدیریت صحنه حادثه و ایمن‌سازی', freq: 'آنی' },

            // BP-19 Policy
            { id: 'T19-1', pid: 'BP-19', role: 'R-CEO', type: 'Main', desc: 'تدوین استراتژی و اهداف سالانه', freq: 'سالانه' },
            { id: 'T19-2', pid: 'BP-19', role: 'R-FIN', type: 'Support', desc: 'بودجه‌بندی کلان سازمان', freq: 'سالانه' },

            // BP-20 Clips
            { id: 'T20-1', pid: 'BP-20', role: 'R-EDU', type: 'Main', desc: 'تعیین موضوع و سناریو کلیپ', freq: 'هفتگی' },
            { id: 'T20-2', pid: 'BP-20', role: 'R-EVT', type: 'Main', desc: 'فیلمبرداری و نورپردازی', freq: 'هفتگی' },
            { id: 'T20-3', pid: 'BP-20', role: 'R-MKT', type: 'Main', desc: 'تدوین حرفه‌ای و گرافیک', freq: 'هفتگی' },
            { id: 'T20-4', pid: 'BP-20', role: 'R-SAL', type: 'Main', desc: 'انتشار و کپشن‌نویسی', freq: 'هفتگی' },

            // BP-21 Archive
            { id: 'T21-1', pid: 'BP-21', role: 'R-ADM', type: 'Main', desc: 'مرتب‌سازی و لیبل‌زنی زونکن‌ها', freq: 'هفتگی' },
            { id: 'T21-2', pid: 'BP-21', role: 'R-ADM', type: 'Main', desc: 'اسکن و بایگانی دیجیتال مدارک', freq: 'روزانه' },

            // BP-22 System
            { id: 'T22-1', pid: 'BP-22', role: 'R-ADM', type: 'Main', desc: 'تعریف ترم و کلاس در سیستم LIMS', freq: 'فصلی' },
            { id: 'T22-2', pid: 'BP-22', role: 'R-INT', type: 'Control', desc: 'نظارت بر عملکرد سرور و شبکه', freq: 'هفتگی' },

            // BP-23 Groups
            { id: 'T23-1', pid: 'BP-23', role: 'R-ADM', type: 'Main', desc: 'ساخت گروه‌های کلاسی واتس‌اپ', freq: 'شروع ترم' },
            { id: 'T23-2', pid: 'BP-23', role: 'R-REC-S', type: 'Main', desc: 'ارسال اطلاعیه‌ها و تکالیف', freq: 'روزانه' },

            // BP-24 Report Cards
            { id: 'T24-1', pid: 'BP-24', role: 'R-SUP-H', type: 'Main', desc: 'پیگیری ثبت نمرات توسط معلمین', freq: 'پایان ترم' },
            { id: 'T24-2', pid: 'BP-24', role: 'R-EDU', type: 'Control', desc: 'کنترل کیفیت نمرات و کامنت‌ها', freq: 'پایان ترم' },
            { id: 'T24-3', pid: 'BP-24', role: 'R-ADM', type: 'Support', desc: 'چاپ و آماده‌سازی کارنامه‌ها', freq: 'پایان ترم' },
            { id: 'T24-4', pid: 'BP-24', role: 'R-SAL', type: 'Main', desc: 'تحویل کارنامه و ثبت‌نام ترم بعد', freq: 'پایان ترم' },

            // BP-25 Online Support
            { id: 'T25-1', pid: 'BP-25', role: 'R-SUP-O', type: 'Main', desc: 'مانیتورینگ آنلاین کلاس‌ها', freq: 'روزانه' },
            { id: 'T25-2', pid: 'BP-25', role: 'R-SUP-O', type: 'Main', desc: 'رفع اشکال فنی اتصال کاربران', freq: 'آنی' },

            // BP-26 Offline Support
            { id: 'T26-1', pid: 'BP-26', role: 'R-REC-S', type: 'Main', desc: 'تماس پیگیری غیبت (Absenteeism)', freq: 'روزانه' },
            { id: 'T26-2', pid: 'BP-26', role: 'R-SAL', type: 'Main', desc: 'تماس سنجش رضایت (Happy Call)', freq: 'ماهانه' },

            // BP-27 Teacher Support
            { id: 'T27-1', pid: 'BP-27', role: 'R-ADM', type: 'Main', desc: 'تکثیر (کپی) ورک‌شیت‌ها', freq: 'روزانه' },
            { id: 'T27-2', pid: 'BP-27', role: 'R-ADM', type: 'Main', desc: 'تجهیز کلاس (ماژیک، تخته پاک‌کن)', freq: 'روزانه' },

            // BP-28 R&D
            { id: 'T28-1', pid: 'BP-28', role: 'R-MKT', type: 'Main', desc: 'پیشنهاد ایده‌های آموزشی جدید', freq: 'فصلی' },
            { id: 'T28-2', pid: 'BP-28', role: 'R-FIN', type: 'Support', desc: 'امکان‌سنجی مالی طرح‌های نو', freq: 'موردی' },
            { id: 'T28-3', pid: 'BP-28', role: 'R-CEO', type: 'Control', desc: 'تصویب و ابلاغ طرح‌های توسعه‌ای', freq: 'موردی' },

            // BP-29 Offboarding
            { id: 'T29-1', pid: 'BP-29', role: 'R-INT', type: 'Main', desc: 'ثبت استعفا و شروع فرآیند خروج', freq: 'موردی' },
            { id: 'T29-2', pid: 'BP-29', role: 'R-ADM', type: 'Support', desc: 'بازپس‌گیری اموال (کلید، لپ‌تاپ)', freq: 'موردی' },
            { id: 'T29-3', pid: 'BP-29', role: 'R-FIN', type: 'Control', desc: 'تسویه حساب مالی نهایی', freq: 'موردی' },

            // BP-30 B2B
            { id: 'T30-1', pid: 'BP-30', role: 'R-MKT', type: 'Main', desc: 'شناسایی مدارس و سازمان‌های هدف', freq: 'فصلی' },
            { id: 'T30-2', pid: 'BP-30', role: 'R-CEO', type: 'Main', desc: 'مذاکره و عقد قرارداد سازمانی', freq: 'موردی' },

            // BP-31 NPS
            { id: 'T31-1', pid: 'BP-31', role: 'R-ADM', type: 'Main', desc: 'ارسال فرم نظرسنجی دیجیتال', freq: 'میان‌ترم' },
            { id: 'T31-2', pid: 'BP-31', role: 'R-MKT', type: 'Control', desc: 'تحلیل داده‌ها و شناسایی نارضایتی', freq: 'فصلی' },

            // BP-32 Asset Audit
            { id: 'T32-1', pid: 'BP-32', role: 'R-ADM', type: 'Main', desc: 'لیست‌برداری و برچسب‌گذاری اموال', freq: 'سالانه' },
            { id: 'T32-2', pid: 'BP-32', role: 'R-FIN', type: 'Control', desc: 'شمارش و مغایرت‌گیری دارایی‌ها', freq: 'سالانه' },

            // BP-33 Knowledge
            { id: 'T33-1', pid: 'BP-33', role: 'R-ADM', type: 'Main', desc: 'تدوین راهنمای مکتوب فرآیندها', freq: 'موردی' },
            { id: 'T33-2', pid: 'BP-33', role: 'R-INT', type: 'Control', desc: 'بروزرسانی مخزن دانش سازمانی', freq: 'سالانه' },

            // BP-34 Mock Exams
            { id: 'T34-1', pid: 'BP-34', role: 'R-EDU', type: 'Main', desc: 'برنامه‌ریزی آزمون‌های ماک', freq: 'ماهانه' },
            { id: 'T34-2', pid: 'BP-34', role: 'R-SUP-H', type: 'Support', desc: 'برگزاری استاندارد آزمون', freq: 'روز آزمون' },

            // BP-35 Alumni
            { id: 'T35-1', pid: 'BP-35', role: 'R-ADM', type: 'Main', desc: 'آپدیت دیتابیس فارغ‌التحصیلان', freq: 'پایان ترم' },
            { id: 'T35-2', pid: 'BP-35', role: 'R-MKT', type: 'Main', desc: 'ارسال آفر بازگشت به تحصیل', freq: 'فصلی' },
        ];

        function EnglishLandBPM() {
            const [activeTab, setActiveTab] = useState('process');
            const [selectedProcess, setSelectedProcess] = useState('BP-01');
            const [selectedRoleForJD, setSelectedRoleForJD] = useState(null);

            // Logic for BPMN
            const bpmnData = useMemo(() => {
                const tasks = tasksDB.filter(t => t.pid === selectedProcess);
                const involvedRoles = [...new Set(tasks.map(t => t.role))];
                involvedRoles.sort((a, b) => {
                    return rolesDB.findIndex(r => r.id === a) - rolesDB.findIndex(r => r.id === b);
                });
                return { tasks, involvedRoles };
            }, [selectedProcess]);

            // Logic for JD
            const getJD = (roleId) => {
                return tasksDB.filter(t => t.role === roleId).map(t => {
                    const p = processesDB.find(proc => proc.id === t.pid);
                    return { ...t, procName: p?.name, procOwner: p?.owner };
                });
            };

            const getPerson = (roleId) => {
                const role = rolesDB.find(r => r.id === roleId);
                return personnelDB.find(p => p.code === role.holder)?.name || 'ناشناس';
            };

            // Recursive function to render the tree
            const renderTree = (parentId) => {
                const children = rolesDB.filter(r => r.parent === parentId);
                if (children.length === 0) return null;
                return (
                    <ul>
                        {children.map(child => {
                            const person = personnelDB.find(p => p.code === child.holder);
                            return (
                                <li key={child.id}>
                                    <div className={`tree-card ${child.color || 'bg-white border-slate-200'}`}>
                                        <div className="flex justify-between items-center mb-1 border-b border-black/5 pb-1">
                                            <span className="text-[10px] font-mono opacity-50">{child.id}</span>
                                            <span className="text-[10px] font-bold bg-white/50 px-1 rounded text-slate-600">{child.holder}</span>
                                        </div>
                                        <div className="font-bold text-sm text-slate-800 py-1">{person?.name}</div>
                                        <div className="text-xs text-slate-500">{child.title}</div>
                                    </div>
                                    {renderTree(child.id)}
                                </li>
                            );
                        })}
                    </ul>
                )
            }

            return (
                <div className="min-h-screen bg-slate-100 font-sans text-slate-800 p-4 lg:p-6" dir="rtl">
                    
                    {/* Header */}
                    <header className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h1 className="text-2xl font-black text-slate-800 flex items-center gap-3">
                                <i className="fas fa-layer-group text-indigo-600 text-3xl"></i>
                                سیستم مدیریت فرآیند <span className="text-yellow-600">EnglishLand</span>
                            </h1>
                            <p className="text-sm text-slate-500 mt-2 font-bold">
                                نسخه ۷.۰ (جامع) | پوشش ۳۵ فرآیند با جزئیات کامل
                            </p>
                        </div>
                        <div className="flex bg-slate-100 p-1 rounded-xl overflow-x-auto max-w-full">
                            <button onClick={() => setActiveTab('process')} className={`px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all whitespace-nowrap ${activeTab === 'process' ? 'bg-white text-indigo-700 shadow-md transform scale-105' : 'text-slate-500 hover:text-slate-700'}`}>
                                <i className="fas fa-network-wired"></i> نقشه فرآیندها
                            </button>
                            <button onClick={() => setActiveTab('jd')} className={`px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all whitespace-nowrap ${activeTab === 'jd' ? 'bg-white text-indigo-700 shadow-md transform scale-105' : 'text-slate-500 hover:text-slate-700'}`}>
                                <i className="fas fa-file-alt"></i> شرح وظایف
                            </button>
                            <button onClick={() => setActiveTab('org')} className={`px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all whitespace-nowrap ${activeTab === 'org' ? 'bg-white text-indigo-700 shadow-md transform scale-105' : 'text-slate-500 hover:text-slate-700'}`}>
                                <i className="fas fa-sitemap"></i> چارت سازمانی
                            </button>
                            <button onClick={() => setActiveTab('bpmn')} className={`px-4 py-2.5 rounded-lg text-sm font-bold flex items-center gap-2 transition-all whitespace-nowrap ${activeTab === 'bpmn' ? 'bg-indigo-600 text-white shadow-md transform scale-105' : 'text-slate-500 hover:text-slate-700'}`}>
                                <i className="fas fa-project-diagram"></i> مدل گرافیکی BPMN
                            </button>
                        </div>
                    </header>

                    {/* TAB 1: PROCESS MAP */}
                    {activeTab === 'process' && (
                        <div className="grid grid-cols-1 gap-6">
                           {processesDB.map(proc => (
                             <div key={proc.id} className={`bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm ${proc.id.includes('17') || proc.id.includes('18') ? 'ring-2 ring-red-100' : ''}`}>
                               <div className={`p-4 border-b border-slate-200 ${proc.id.includes('17') || proc.id.includes('18') ? 'bg-red-50' : 'bg-slate-50'}`}>
                                 <div className="flex justify-between items-center">
                                   <h3 className="font-bold text-slate-800 flex items-center gap-2">
                                     {proc.id.includes('17') || proc.id.includes('18') ? <i className="fas fa-exclamation-triangle text-red-500"></i> : <div className="w-2 h-2 bg-blue-500 rounded-full"></div>}
                                     {proc.name} <span className="text-xs font-normal text-slate-400">({proc.id})</span>
                                   </h3>
                                   <div className="text-xs text-slate-500 bg-white border border-slate-200 px-2 py-1 rounded">
                                     ناظر فرآیند: <strong className="text-blue-600">{rolesDB.find(r => r.id === proc.owner)?.title}</strong>
                                   </div>
                                 </div>
                                 <p className="text-xs text-slate-500 mt-2 mr-4">{proc.description}</p>
                               </div>
                               
                               <div className="p-6 overflow-x-auto">
                                 <div className="flex items-start min-w-max gap-4">
                                    {tasksDB.filter(t => t.pid === proc.id).map((task, idx) => {
                                      const roleInfo = rolesDB.find(r => r.id === task.role);
                                      const personName = getPerson(task.role);
                                      return (
                                        <div key={task.id} className="flex items-center gap-4">
                                           <div className="relative w-64 bg-white border border-slate-200 rounded-lg p-3 shadow-sm hover:border-blue-300 hover:shadow-md transition-all group">
                                              <div className="absolute top-0 right-0 bg-slate-100 text-slate-500 text-[9px] px-2 rounded-bl-lg border-b border-l border-slate-200">
                                                مرحله {idx + 1}
                                              </div>
                                              <div className="mt-3">
                                                <div className="text-xs font-bold text-slate-700 mb-1 line-clamp-2 h-8">{task.desc}</div>
                                                <div className="flex justify-between items-end mt-2 pt-2 border-t border-slate-100">
                                                  <div>
                                                    <div className="text-[10px] text-blue-600 font-bold">{roleInfo.title}</div>
                                                    <div className="text-[9px] text-slate-400">{personName}</div>
                                                  </div>
                                                  <div className="text-[9px] bg-slate-50 px-1.5 py-0.5 rounded text-slate-500 border border-slate-100">
                                                    {task.freq}
                                                  </div>
                                                </div>
                                              </div>
                                           </div>
                                           {idx < tasksDB.filter(t => t.pid === proc.id).length - 1 && (
                                             <i className="fas fa-arrow-left text-slate-300"></i>
                                           )}
                                        </div>
                                      )
                                    })}
                                 </div>
                               </div>
                             </div>
                           ))}
                        </div>
                    )}

                    {/* TAB 2: JD */}
                    {activeTab === 'jd' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div className="lg:col-span-1 space-y-2">
                                <div className="bg-white p-3 rounded-lg border border-slate-200 mb-2">
                                    <h3 className="text-xs font-bold text-slate-400 mb-2">لیست پرسنل</h3>
                                    <div className="relative">
                                        <i className="fas fa-search absolute left-2 top-2.5 text-slate-300 text-sm"></i>
                                        <input type="text" placeholder="جستجو..." className="w-full bg-slate-50 border border-slate-200 rounded p-2 text-sm pl-8" />
                                    </div>
                                </div>
                                <div className="space-y-2 h-[600px] overflow-y-auto">
                                    {rolesDB.filter(r => r.id.startsWith('R-')).map(role => {
                                        const p = personnelDB.find(x => x.code === role.holder);
                                        return (
                                            <button key={role.id} onClick={() => setSelectedRoleForJD(role.id)} className={`w-full text-right p-3 rounded-xl border transition-all ${selectedRoleForJD === role.id ? 'bg-indigo-50 border-indigo-300 shadow-sm' : 'bg-white border-slate-100 hover:bg-slate-50'}`}>
                                                <div className="font-bold text-slate-700 text-sm">{p?.name || 'موقعیت خالی'}</div>
                                                <div className="text-xs text-slate-500">
                                                    {role.title} <span className="font-mono text-[9px] bg-slate-100 px-1 rounded text-slate-400">{role.id}</span>
                                                </div>
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                            <div className="lg:col-span-3">
                                {selectedRoleForJD ? (
                                    <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-8 min-h-[600px]">
                                        <div className="flex items-center gap-4 mb-8 pb-6 border-b border-slate-100">
                                            <div className="w-16 h-16 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 text-2xl font-bold">
                                                {personnelDB.find(p => p.code === rolesDB.find(r => r.id === selectedRoleForJD).holder)?.name.charAt(0) || '?'}
                                            </div>
                                            <div>
                                                <h2 className="text-2xl font-black text-slate-800">
                                                    {personnelDB.find(p => p.code === rolesDB.find(r => r.id === selectedRoleForJD).holder)?.name || 'موقعیت خالی'}
                                                </h2>
                                                <div className="text-indigo-600 font-bold bg-indigo-50 px-3 py-1 rounded-full text-sm inline-block mt-2">
                                                    {rolesDB.find(r => r.id === selectedRoleForJD).title}
                                                    <span className="mr-2 text-indigo-400 text-xs border-r border-indigo-200 pr-2 font-mono">
                                                        {selectedRoleForJD}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div className="col-span-2">
                                                <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2"><i className="fas fa-briefcase"></i> لیست وظایف بر اساس فرآیند</h3>
                                                <div className="space-y-3">
                                                    {getJD(selectedRoleForJD).length > 0 ? getJD(selectedRoleForJD).map((task, idx) => (
                                                        <div key={idx} className="flex items-start gap-4 p-4 rounded-xl border border-slate-100 hover:border-indigo-200 hover:shadow-sm transition-all bg-slate-50/50">
                                                            <div className={`mt-1 min-w-[60px] text-center px-2 py-1 rounded text-[10px] font-bold ${task.type === 'Main' ? 'bg-emerald-100 text-emerald-700' : task.type === 'Control' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'}`}>
                                                                {task.type === 'Main' ? 'اجرا' : task.type === 'Control' ? 'تایید' : 'کمک'}
                                                            </div>
                                                            <div className="flex-grow">
                                                                <p className="text-sm font-bold text-slate-800">{task.desc}</p>
                                                                <div className="flex gap-4 mt-2 text-xs text-slate-400">
                                                                    <span className="flex items-center gap-1"><i className="fas fa-layer-group"></i> {task.procName}</span>
                                                                    <span className="flex items-center gap-1 text-indigo-400"><i className="fas fa-clock"></i> {task.freq}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )) : <div className="text-center py-10 text-slate-400">وظیفه‌ای تعریف نشده است.</div>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : <div className="h-full flex items-center justify-center text-slate-300">لطفاً یک شخص را انتخاب کنید</div>}
                            </div>
                        </div>
                    )}

                    {/* TAB 3: ORG CHART (Dynamic) */}
                    {activeTab === 'org' && (
                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-10 overflow-x-auto text-center" dir="ltr">
                            <div className="tree">
                                <ul>
                                    {rolesDB.filter(r => r.parent === null).map(rootRole => {
                                        const rootPerson = personnelDB.find(p => p.code === rootRole.holder);
                                        return (
                                            <li key={rootRole.id}>
                                                <div className={`tree-card ${rootRole.color}`}>
                                                    <div className="flex justify-between items-center mb-1 border-b border-black/5 pb-1">
                                                        <span className="text-[10px] font-mono opacity-50">{rootRole.id}</span>
                                                        <span className="text-[10px] font-bold bg-white/50 px-1 rounded text-slate-600">{rootRole.holder}</span>
                                                    </div>
                                                    <div className="font-bold text-lg text-slate-800 py-1">{rootPerson?.name}</div>
                                                    <div className="text-xs text-slate-500">{rootRole.title}</div>
                                                </div>
                                                {renderTree(rootRole.id)}
                                            </li>
                                        );
                                    })}
                                </ul>
                            </div>
                        </div>
                    )}

                    {/* TAB 4: BPMN MODEL */}
                    {activeTab === 'bpmn' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                            <div className="lg:col-span-1 bg-white rounded-2xl border border-slate-200 shadow-sm p-4 h-[calc(100vh-200px)] overflow-y-auto">
                                <h3 className="font-bold text-slate-700 mb-4 flex items-center gap-2">
                                    <i className="fas fa-layer-group"></i> انتخاب فرآیند
                                </h3>
                                <div className="space-y-2">
                                    {processesDB.map(proc => (
                                        <button
                                            key={proc.id}
                                            onClick={() => setSelectedProcess(proc.id)}
                                            className={`w-full text-right p-3 rounded-xl border transition-all text-xs font-bold flex flex-col gap-1 ${selectedProcess === proc.id ? 'bg-indigo-50 border-indigo-300 text-indigo-800 shadow-sm' : 'bg-white border-slate-100 text-slate-600 hover:bg-slate-50'}`}
                                        >
                                            <div className="flex justify-between w-full">
                                                <span>{proc.name}</span>
                                                <span className="opacity-50">{proc.id}</span>
                                            </div>
                                            {proc.id.includes('17') || proc.id.includes('18') ? 
                                                <span className="text-[10px] text-red-500 flex items-center gap-1"><i className="fas fa-exclamation-triangle"></i> اضطراری</span> : null
                                            }
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="lg:col-span-3 bg-white rounded-2xl border border-slate-200 shadow-sm p-6 overflow-x-auto relative">
                                <div className="absolute top-4 left-4 bg-slate-100 px-3 py-1 rounded text-xs text-slate-500 font-mono">BPMN View Mode</div>
                                <h2 className="text-xl font-black text-indigo-900 mb-2 flex items-center gap-2">
                                    {processesDB.find(p => p.id === selectedProcess).name}
                                </h2>
                                <p className="text-sm text-slate-500 mb-8 max-w-2xl">{processesDB.find(p => p.id === selectedProcess).description}</p>

                                <div className="min-w-[800px] border-2 border-slate-300 rounded-lg bg-slate-50 relative">
                                    <div className="absolute top-0 bottom-0 left-10 w-px bg-slate-200 z-0"></div>
                                    {bpmnData.involvedRoles.map((roleId, rIndex) => {
                                        const roleInfo = rolesDB.find(r => r.id === roleId);
                                        const roleTasks = bpmnData.tasks.filter(t => t.role === roleId);
                                        return (
                                            <div key={roleId} className="flex border-b border-slate-300 last:border-b-0 min-h-[120px]">
                                                <div className={`w-40 flex-shrink-0 p-4 border-l border-slate-300 flex flex-col justify-center items-center text-center ${roleInfo.color}`}>
                                                    <div className="font-bold text-xs">{roleInfo.title}</div>
                                                    <div className="text-[10px] opacity-70 mt-1">{personnelDB.find(p => p.code === roleInfo.holder)?.name}</div>
                                                </div>
                                                <div className="flex-grow relative p-4 flex items-center gap-8 overflow-x-auto">
                                                    {roleTasks.map((task, tIndex) => (
                                                        <div key={task.id} className="relative z-10">
                                                            <div className={`w-48 p-3 rounded-lg border-2 shadow-sm text-right relative ${task.type === 'Control' ? 'border-red-200 bg-red-50' : task.type === 'Support' ? 'border-amber-200 bg-amber-50' : 'border-indigo-200 bg-white'}`}>
                                                                {tIndex === 0 && rIndex === 0 && <div className="absolute -right-3 top-1/2 -translate-y-1/2 w-2 h-2 bg-green-500 rounded-full"></div>}
                                                                <div className="text-[10px] font-bold opacity-50 mb-1 flex justify-between">
                                                                    <span>{task.id}</span>
                                                                    <span className="uppercase">{task.type}</span>
                                                                </div>
                                                                <div className="text-xs font-bold text-slate-800 leading-tight">{task.desc}</div>
                                                                <div className="absolute top-1/2 -left-4 transform -translate-y-1/2 text-slate-300">
                                                                    <i className="fas fa-arrow-left"></i>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="mt-6 flex gap-4 text-xs text-slate-500 justify-center">
                                    <span className="flex items-center gap-1"><div className="w-3 h-3 bg-white border-2 border-indigo-200 rounded"></div> وظیفه اجرایی</span>
                                    <span className="flex items-center gap-1"><div className="w-3 h-3 bg-red-50 border-2 border-red-200 rounded"></div> نظارت/تایید</span>
                                    <span className="flex items-center gap-1"><div className="w-3 h-3 bg-amber-50 border-2 border-amber-200 rounded"></div> پشتیبانی</span>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EnglishLandBPM />);
    </script>
</body>
</html>
